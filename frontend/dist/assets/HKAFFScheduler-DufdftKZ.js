import{c as I,u as H,r as c,j as e,C as P,a as U,b as X,M as G,d as J,e as Q,R as Y,s as C,F as A,f as W}from"./index-DMkoEHv9.js";import{f as R,c as ee}from"./conflictDetector-BvYDVP-k.js";import{T as te,S as se,X as ne}from"./ScheduleView-VThistk5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],z=I("heart",re);function ie({film:l,selectedScreenings:y,existingSelections:f,onToggleScreening:N,onShowDetails:F,getVenueById:M}){const{t:v,i18n:n}=H(),o=n.language==="tc",[p,_]=c.useState(!1),D=d=>{if(!f.length)return[];const b=l.screenings.find(u=>u.id===d);if(!b)return[];const g=M(b.venue_id),x=g?.name_en||"",i=g?.name_tc||"";return ee.wouldConflict(f,b,x,i)},w=o?l.film.title_tc:l.film.title_en,$=l.film.director;return e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-150",children:[e.jsx("div",{className:"w-full aspect-[2/3] overflow-hidden bg-gray-100",children:e.jsx("img",{src:l.film.poster_url||"/placeholder-poster.jpg",alt:w,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 line-clamp-2",children:w}),e.jsxs("p",{className:"text-sm text-gray-600",children:[$||"—"," • 2025"]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:o?l.category.name_tc:l.category.name_en})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[e.jsxs("button",{className:"w-full flex justify-between items-center px-2 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded transition-colors",onClick:()=>_(!p),"aria-expanded":p,children:[e.jsxs("span",{children:[l.screenings.length," ",l.screenings.length===1?o?"場放映":"screening":o?"場放映":"screenings"]}),p?e.jsx(P,{size:16}):e.jsx(U,{size:16})]}),p&&e.jsx("div",{className:"mt-2 space-y-2",children:l.screenings.map(d=>{const b=M(d.venue_id),g=y.includes(d.id),x=D(d.id),i=x.length>0,u=x.length>0?x[0].severity:void 0;return e.jsxs("div",{className:`p-3 rounded border transition-colors duration-150 ${g?"bg-green-50 border-green-500":i?"bg-orange-50 border-orange-500":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(X,{size:12}),e.jsx("span",{children:R(new Date(d.datetime),"MMM dd HH:mm")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(G,{size:12}),e.jsx("span",{className:"line-clamp-1",children:o?b?.name_tc:b?.name_en})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.duration_minutes," ",o?"分鐘":"min"]})]}),i&&!g&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-orange-100 rounded text-orange-800 mb-2",children:[e.jsx(te,{size:12}),e.jsx("span",{className:"text-xs font-medium",children:u==="impossible"?o?"時間重疊":"Overlaps":o?"換場緊迫":"Tight timing"})]}),e.jsx("button",{className:`w-full py-2 px-3 rounded text-sm font-medium transition-colors flex items-center justify-center gap-2 ${g?"bg-green-600 hover:bg-green-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,onClick:()=>N(d.id),children:g?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:14}),e.jsx("span",{children:v("screening.selected")})]}):e.jsx("span",{children:v("screening.select")})})]},d.id)})})]}),e.jsx("button",{className:"w-full mt-3 py-2 px-4 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors",onClick:()=>F(l.film.id),children:v("filmCard.details")})]})]})}function de({films:l,screenings:y,venues:f,categories:N,onNavigateToCatalogue:F}){const{i18n:M}=H(),{showToast:v}=Q(),n=M.language==="tc",[o,p]=c.useState([]),[_,D]=c.useState("all"),[w,$]=c.useState("all"),[d,b]=c.useState("all"),[g,x]=c.useState("browse"),[i,u]=c.useState(null),m=c.useMemo(()=>y.map(t=>{const s=l.find(S=>S.id===t.film_id),r=f.find(S=>S.id===t.venue_id),a=N.find(S=>S.id===s?.category_id);if(!s)return console.warn(`Film not found for screening ${t.id}, film_id: ${t.film_id}`),null;if(!r)return console.warn(`Venue not found for screening ${t.id}, venue_id: ${t.venue_id}`),null;if(!a)return console.warn(`Category not found for film ${s.id}, category_id: ${s.category_id}`),null;const h=new Date(t.datetime),j=h.toISOString().split("T")[0],Z=h.toTimeString().slice(0,5);return{id:t.id,title:n?s.title_tc:s.title_en,category:n?a.name_tc:a.name_en,venue:n?r.name_tc:r.name_en,date:j,time:Z,duration:t.duration_minutes,director:s.director,country:s.country,language:t.language,description:n?s.synopsis_tc:s.synopsis_en,film:s,screening:t}}).filter(Boolean),[y,l,f,N,n]),q=c.useMemo(()=>[...new Set(m.map(t=>t.category))],[m]),K=c.useMemo(()=>[...new Set(m.map(t=>t.venue))],[m]),L=c.useMemo(()=>[...new Set(m.map(t=>t.date))].sort(),[m]),E=c.useMemo(()=>{const t=new Map;return m.forEach(s=>{const r=s.film.id;if(!t.has(r)){const a=N.find(h=>h.id===s.film.category_id);t.set(r,{film:s.film,screenings:[],category:a})}t.get(r).screenings.push(s.screening)}),Array.from(t.values())},[m,N]),k=c.useMemo(()=>E.filter(t=>_!=="all"&&!(n?t.category.name_tc===_:t.category.name_en===_)?!1:t.screenings.some(r=>{const a=m.find(h=>h.id===r.id);return!(!a||w!=="all"&&a.venue!==w||d!=="all"&&a.date!==d)})),[E,_,w,d,m,n]);Y.useEffect(()=>{const s=C.getSelections().map(r=>r.screening_id);p(s)},[]);const T=t=>{const s=m.find(r=>r.id===t);if(s)try{if(o.includes(t))C.removeSelection(t),p(r=>r.filter(a=>a!==t)),v(n?"已移除場次":"Screening removed","info");else{const r=f.find(a=>a.id===s.screening.venue_id);if(!r)throw new Error("Venue not found");C.addSelection(s.screening,s.film,r),p(a=>[...a,t]),v(n?"已加入場次":"Screening added","success")}}catch(r){console.error("Failed to toggle screening:",r),v(n?"操作失敗，請重試":"Operation failed, please try again","error")}},V=t=>{const s=new Date(t);return R(s,"MMM d, EEE")},O=t=>t.slice(0,5),B=t=>t.map(s=>{const r=l.find(j=>j.id===s.film_snapshot.id),a=y.find(j=>j.id===s.screening_snapshot.id),h=f.find(j=>j.name_tc===s.screening_snapshot.venue_name_tc&&j.name_en===s.screening_snapshot.venue_name_en);return{screening_id:s.screening_id,added_at:s.added_at,film_snapshot:r||{id:s.film_snapshot.id,title_tc:s.film_snapshot.title_tc,title_en:s.film_snapshot.title_en,category_id:"",synopsis_tc:"",synopsis_en:"",runtime_minutes:s.screening_snapshot.duration_minutes,director:"",country:"",poster_url:s.film_snapshot.poster_url||"",detail_url_tc:"",detail_url_en:""},screening_snapshot:a||{id:s.screening_snapshot.id,film_id:s.film_snapshot.id,venue_id:h?.id||"",datetime:s.screening_snapshot.datetime,duration_minutes:s.screening_snapshot.duration_minutes,language:""},venue_snapshot:h||{id:"",name_tc:s.screening_snapshot.venue_name_tc,name_en:s.screening_snapshot.venue_name_en}}});return e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:n?"香港亞洲電影節 2025":"HKAFF 2025"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:n?`${l.length} 部電影 • ${y.length} 場放映`:`${l.length} Films • ${y.length} Screenings`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>F?F():x("browse"),className:`px-6 py-2 rounded-lg font-medium transition-colors duration-150 ${g==="browse"?"bg-red-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx(A,{className:"inline mr-2 w-4 h-4"}),n?"瀏覽電影":"Browse Films"]}),e.jsxs("button",{onClick:()=>x("schedule"),className:`px-6 py-2 rounded-lg font-medium transition-colors duration-150 relative ${g==="schedule"?"bg-red-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx(W,{className:"inline mr-2 w-4 h-4"}),n?"我的時間表":"My Schedule",o.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full min-w-[18px] h-4 px-1 flex items-center justify-center",children:o.length})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:g==="browse"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-md p-6 mb-6 border border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-white",children:n?"篩選場次":"Filter Screenings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:n?"類別":"Category"}),e.jsxs("select",{value:_,onChange:t=>D(t.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:n?"所有類別":"All Categories"}),q.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:n?"場地":"Venue"}),e.jsxs("select",{value:w,onChange:t=>$(t.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:n?"所有場地":"All Venues"}),K.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:n?"日期":"Date"}),e.jsxs("select",{value:d,onChange:t=>b(t.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:n?"所有日期":"All Dates"}),L.map(t=>e.jsx("option",{value:t,children:V(t)},t))]})]})]})]}),e.jsx("div",{className:"mb-4 text-gray-400 text-sm",children:n?`顯示 ${k.length} 部電影`:`Showing ${k.length} of ${l.length} films`}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(t=>e.jsx(ie,{film:t,selectedScreenings:o,existingSelections:C.getSelections(),onToggleScreening:T,onShowDetails:s=>{const r=m.find(a=>a.film.id===s);r&&u(r)},getVenueById:s=>f.find(r=>r.id===s)},t.film.id))}),k.length===0&&e.jsxs("div",{className:"text-center py-16 bg-gray-900 rounded-lg shadow-md border border-gray-800",children:[e.jsx(A,{className:"w-16 h-16 mx-auto text-gray-500 mb-4"}),e.jsx("p",{className:"text-xl text-gray-400",children:n?"沒有符合篩選條件的電影":"No films match your filters"})]})]}):e.jsx(se,{selections:B(C.getSelections()),onRemove:T,onNavigateToCatalogue:()=>x("browse")})}),i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"film-detail-title",children:[e.jsx("button",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>u(null),onKeyDown:t=>{t.key==="Escape"&&u(null)},"aria-label":n?"關閉":"Close"}),e.jsxs("div",{className:"relative bg-gray-900 rounded-2xl max-w-2xl w-full p-8 shadow-2xl max-h-[90vh] overflow-y-auto border border-gray-700",children:[i.film.poster_url&&e.jsx("div",{className:"mb-6 rounded-lg overflow-hidden",children:e.jsx("img",{src:i.film.poster_url,alt:i.title,className:"w-full h-64 object-cover",onError:t=>t.currentTarget.style.display="none"})}),e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold px-3 py-1 bg-blue-100 text-blue-800 rounded-full",children:i.category}),e.jsx("h2",{id:"film-detail-title",className:"text-3xl font-bold mt-3 text-white",children:i.title}),i.director&&e.jsx("p",{className:"text-lg text-gray-400 mt-1",children:i.director})]}),e.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-card-foreground mb-6 leading-relaxed",children:i.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:n?"日期與時間":"Date & Time"}),e.jsxs("div",{className:"font-semibold text-white",children:[V(i.date),e.jsx("br",{}),O(i.time)]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:n?"場地":"Venue"}),e.jsx("div",{className:"font-semibold text-white",children:i.venue})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:n?"片長":"Duration"}),e.jsxs("div",{className:"font-semibold text-white",children:[i.duration," ",n?"分鐘":"minutes"]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:n?"語言":"Language"}),e.jsx("div",{className:"font-semibold text-white",children:i.language||(n?"未指定":"Not specified")})]})]}),e.jsx("button",{onClick:()=>{T(i.id),u(null)},className:`w-full py-4 rounded-lg font-semibold text-lg transition-colors duration-150 ${o.includes(i.id),"bg-red-600 hover:bg-red-700 text-white shadow-md"}`,children:o.includes(i.id)?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"inline mr-2 w-5 h-5 fill-current"}),n?"從時間表移除":"Remove from Schedule"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"inline mr-2 w-5 h-5"}),n?"加入時間表":"Add to Schedule"]})})]})]})]})}export{de as default};
