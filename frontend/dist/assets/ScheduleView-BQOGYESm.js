import{u as v,j as e,r as N}from"./index-DHBLqyUS.js";import{f}from"./format-Cdttx4Da.js";import{c as _}from"./conflictDetector-DwZVPXZI.js";const k=({conflict:a})=>{const{i18n:l}=v(),i=l.language==="zh",g=i?a.message_tc:a.message_en,t=a.severity==="impossible";return e.jsxs("div",{"data-testid":"conflict-warning",className:`flex items-start gap-2 p-3 rounded-md ${t?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsx("svg",{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${t?"text-red-500":"text-yellow-600"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:`text-sm font-medium ${t?"text-red-800":"text-yellow-800"}`,children:[t?i?"è¡çª":"Conflict":i?"è­¦å‘Š":"Warning",": ",g]}),t&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i?"æ­¤å ´æ¬¡èˆ‡å¦ä¸€å ´æ¬¡æ™‚é–“é‡ç–Šï¼Œç„¡æ³•åŒæ™‚è§€çœ‹":"This screening overlaps with another and cannot be attended simultaneously"})]})]})},M=({selection:a,conflicts:l,onRemove:i})=>{const{i18n:g}=v(),t=g.language==="zh",{film_snapshot:c,screening_snapshot:d,venue_snapshot:m}=a,x=t?c.title_tc:c.title_en,n=t?m.name_tc:m.name_en,r=f(new Date(d.datetime),"HH:mm"),u=l&&l.length>0;return e.jsx("div",{"data-testid":"schedule-item",className:"bg-card rounded-lg p-4 border border-border shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[u&&e.jsx("div",{"data-testid":"conflict-icon",className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{"data-testid":"schedule-time",className:"text-lg font-bold text-foreground",children:r}),e.jsx("span",{"data-testid":"schedule-film-title",className:"text-foreground font-medium",children:x})]}),e.jsx("div",{"data-testid":"schedule-venue",className:"text-muted-foreground text-sm mb-1",children:n}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[d.duration_minutes," ",t?"åˆ†é˜":"minutes"]}),u&&e.jsx("div",{className:"mt-3",children:l.map((p,h)=>e.jsx(k,{conflict:p},h))})]})]})}),e.jsx("button",{"data-testid":"remove-screening-btn",onClick:()=>i(a.screening_id),className:"flex-shrink-0 min-h-[44px] min-w-[44px] p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors focus:ring-2 focus:ring-red-500","aria-label":t?`ç§»é™¤ ${x} - ${r}`:`Remove ${x} at ${r}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})},C=({date:a,screenings:l,onRemoveScreening:i})=>{const{i18n:g}=v(),t=g.language==="zh",c=d=>{const m=new Date(d),x=f(m,"EEEE");if(t){const n=f(m,"M"),r=f(m,"d");return`${n}æœˆ${r}æ—¥ (${{Monday:"æ˜ŸæœŸä¸€",Tuesday:"æ˜ŸæœŸäºŒ",Wednesday:"æ˜ŸæœŸä¸‰",Thursday:"æ˜ŸæœŸå››",Friday:"æ˜ŸæœŸäº”",Saturday:"æ˜ŸæœŸå…­",Sunday:"æ˜ŸæœŸæ—¥"}[x]||x})`}else return f(m,"MMMM d (EEEE)")};return e.jsxs("div",{"data-testid":"date-group",className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("h3",{"data-testid":"date-header",className:"text-lg font-semibold text-foreground mb-4",children:c(a)}),e.jsx("div",{className:"space-y-3",children:l.map(d=>e.jsx(M,{selection:d,conflicts:d.conflicts,onRemove:i},d.screening_id))})]})},S=({selections:a,onRemoveScreening:l,onExport:i})=>{const{i18n:g}=v(),t=g.language==="tc",c=N.useMemo(()=>{if(a.length===0)return[];const n=[...a].sort((s,o)=>new Date(s.screening_snapshot.datetime).getTime()-new Date(o.screening_snapshot.datetime).getTime()),r=new Map;n.forEach(s=>{const o=f(new Date(s.screening_snapshot.datetime),"yyyy-MM-dd");r.has(o)||r.set(o,[]),r.get(o).push(s)});const u=n.map(s=>({screening_id:s.screening_id,added_at:s.added_at,film_snapshot:{id:s.film_snapshot.id,title_tc:s.film_snapshot.title_tc,title_en:s.film_snapshot.title_en,poster_url:s.film_snapshot.poster_url},screening_snapshot:{id:s.screening_snapshot.id,datetime:s.screening_snapshot.datetime,duration_minutes:s.screening_snapshot.duration_minutes,venue_name_tc:s.venue_snapshot.name_tc,venue_name_en:s.venue_snapshot.name_en}})),p=_.detectConflicts(u),h=new Map;p.forEach(s=>{const o={severity:s.severity,screening_ids:[s.screening_a.screening_id,s.screening_b.screening_id],overlap_minutes:s.overlap_minutes,message_tc:s.severity==="impossible"?`èˆ‡å¦ä¸€å ´æ¬¡é‡ç–Š ${s.overlap_minutes} åˆ†é˜`:"èˆ‡å¦ä¸€å ´æ¬¡é–“éš”å°‘æ–¼30åˆ†é˜ï¼Œä¸”åœ¨ä¸åŒå ´åœ°",message_en:s.severity==="impossible"?`Overlaps ${s.overlap_minutes} minutes with another screening`:"Less than 30 minutes between screenings at different venues"};h.has(s.screening_a.screening_id)||h.set(s.screening_a.screening_id,[]),h.get(s.screening_a.screening_id).push(o),h.has(s.screening_b.screening_id)||h.set(s.screening_b.screening_id,[]),h.get(s.screening_b.screening_id).push(o)});const y=[];return r.forEach((s,o)=>{const w=s.map(j=>{const b=h.get(j.screening_id);return{...j,conflicts:b&&b.length>0?b:void 0}});y.push({date:o,screenings:w})}),y},[a]);if(a.length===0)return e.jsx("div",{"data-testid":"schedule-view",className:"bg-gradient-to-br from-white via-gray-50 to-white rounded-3xl shadow-2xl p-12 border border-gray-100",children:e.jsxs("div",{"data-testid":"schedule-empty-state",className:"text-center max-w-2xl mx-auto space-y-10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 flex items-center justify-center shadow-2xl animate-pulse",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 via-secondary/20 to-accent/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary/20 animate-ping",style:{animationDuration:"3s"}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-secondary/20 animate-ping",style:{animationDuration:"4s",animationDelay:"1s"}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-4xl font-black bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent",children:t?"é–‹å§‹è¦åŠƒæ‚¨çš„é›»å½±ä¹‹æ—…":"Start Planning Your Film Journey"}),e.jsx("p",{className:"text-gray-600 leading-relaxed text-lg max-w-xl mx-auto",children:t?"ç€è¦½å½±ç‰‡ç›®éŒ„ï¼Œé¸æ“‡æ‚¨å–œæ„›çš„å ´æ¬¡ï¼Œå»ºç«‹å°ˆå±¬çš„è§€å½±æ™‚é–“è¡¨ã€‚æˆ‘å€‘æœƒè‡ªå‹•ç‚ºæ‚¨æª¢æ¸¬æ™‚é–“è¡çªï¼":"Browse the catalogue, select your favorite screenings, and build your personalized schedule. We'll automatically detect conflicts for you!"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-gray-400",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"}),e.jsx("span",{className:"font-semibold",children:t?"å¿«é€Ÿé–‹å§‹":"Quick Start"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-l from-transparent via-gray-300 to-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-primary/5 to-primary/10 border border-primary/20 hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸŽ¬"}),e.jsx("div",{className:"font-bold text-primary mb-2 text-base",children:t?"æŽ¢ç´¢é›»å½±":"Explore Films"}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:t?"ç€è¦½è±å¯Œçš„é›»å½±é¸æ“‡ï¼Œç™¼ç¾ç²¾å½©ä½œå“":"Browse our rich film selection and discover great works"})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-secondary/5 to-secondary/10 border border-secondary/20 hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsx("div",{className:"text-4xl mb-3",children:"â°"}),e.jsx("div",{className:"font-bold text-secondary mb-2 text-base",children:t?"é¸æ“‡å ´æ¬¡":"Pick Screenings"}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:t?"é¸æ“‡æœ€é©åˆæ‚¨çš„æ”¾æ˜ æ™‚é–“å’Œå ´åœ°":"Choose the best screening times and venues for you"})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-accent/5 to-accent/10 border border-accent/20 hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsx("div",{className:"text-4xl mb-3",children:"âœ¨"}),e.jsx("div",{className:"font-bold text-accent mb-2 text-base",children:t?"è‡ªå‹•æª¢æ¸¬":"Auto-Detect"}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:t?"ç³»çµ±è‡ªå‹•æª¢æ¸¬æ™‚é–“è¡çªï¼Œè¼•é¬†è¦åŠƒ":"System automatically detects conflicts for easy planning"})]})]}),e.jsxs("button",{onClick:()=>window.history.back(),className:"w-full sm:w-auto px-10 py-4 bg-gradient-to-r from-primary via-secondary to-accent text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3 group mx-auto",children:[e.jsx("svg",{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M7 16l-4-4m0 0l4-4m-4 4h18"})}),e.jsx("span",{children:t?"è¿”å›žç€è¦½é›»å½±":"Browse Films"})]})]})});const d=c.length,m=a.length,x=a.filter(n=>!!c.find(u=>u.screenings.find(p=>p.screening_id===n.screening_id&&p.conflicts))).length;return e.jsxs("div",{"data-testid":"schedule-view",className:"bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 p-8 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-5xl font-black bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent",children:t?"æˆ‘çš„è§€å½±æ™‚é–“è¡¨":"My Schedule"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary animate-pulse"}),e.jsxs("span",{className:"text-gray-700 font-semibold",children:[m," ",t?"å ´æ¬¡":"screenings"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-secondary"}),e.jsxs("span",{className:"text-gray-700 font-semibold",children:[d," ",t?"å¤©":"days"]})]}),x>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-destructive/10 rounded-full shadow-sm border border-destructive/20",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-destructive animate-pulse"}),e.jsxs("span",{className:"text-destructive font-bold",children:["âš ï¸ ",x," ",t?"å€‹è¡çª":"conflicts"]})]})]})]}),e.jsxs("button",{"data-testid":"export-btn",onClick:i,"aria-label":t?"åŒ¯å‡ºæˆ‘çš„è§€å½±æ™‚é–“è¡¨ç‚º Markdown":"Export my schedule as Markdown",className:"group relative min-h-[56px] px-10 py-4 bg-gradient-to-br from-secondary via-secondary to-accent text-white rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 focus:ring-4 focus:ring-secondary/50 focus:ring-offset-2 transition-all duration-300 overflow-hidden flex items-center gap-3 whitespace-nowrap",children:[e.jsx("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/30 to-transparent"}),e.jsx("svg",{className:"w-6 h-6 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"relative z-10 text-lg",children:t?"åŒ¯å‡º Markdown":"Export"})]})]})}),e.jsx("div",{className:"p-8 space-y-8",children:c.map((n,r)=>e.jsxs("div",{children:[e.jsx(C,{date:n.date,screenings:n.screenings,onRemoveScreening:l}),r<c.length-1&&e.jsx("div",{className:"mt-8 h-px bg-gradient-to-r from-transparent via-border to-transparent"})]},n.date))})]})};export{S as ScheduleView};
