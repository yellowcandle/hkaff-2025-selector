import{u as j,j as e,r as k}from"./index-Bo_XGaqe.js";import{f as u}from"./format-Cdttx4Da.js";const T=({conflict:n})=>{const{i18n:d}=j(),o=d.language==="zh",m=o?n.message_tc:n.message_en,s=n.severity==="impossible";return e.jsxs("div",{"data-testid":"conflict-warning",className:`flex items-start gap-2 p-3 rounded-md ${s?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsx("svg",{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${s?"text-red-500":"text-yellow-600"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:`text-sm font-medium ${s?"text-red-800":"text-yellow-800"}`,children:[s?o?"衝突":"Conflict":o?"警告":"Warning",": ",m]}),s&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:o?"此場次與另一場次時間重疊，無法同時觀看":"This screening overlaps with another and cannot be attended simultaneously"})]})]})},E=({selection:n,conflicts:d,onRemove:o})=>{const{i18n:m}=j(),s=m.language==="zh",{film_snapshot:h,screening_snapshot:t,venue_snapshot:r}=n,l=s?h.title_tc:h.title_en,i=s?r.name_tc:r.name_en,a=u(new Date(t.datetime),"HH:mm"),x=d&&d.length>0;return e.jsx("div",{"data-testid":"schedule-item",className:"bg-card rounded-lg p-4 border border-border shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[x&&e.jsx("div",{"data-testid":"conflict-icon",className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{"data-testid":"schedule-time",className:"text-lg font-bold text-foreground",children:a}),e.jsx("span",{"data-testid":"schedule-film-title",className:"text-foreground font-medium",children:l})]}),e.jsx("div",{"data-testid":"schedule-venue",className:"text-muted-foreground text-sm mb-1",children:i}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[t.duration_minutes," ",s?"分鐘":"minutes"]}),x&&e.jsx("div",{className:"mt-3",children:d.map((c,w)=>e.jsx(T,{conflict:c},w))})]})]})}),e.jsx("button",{"data-testid":"remove-screening-btn",onClick:()=>o(n.screening_id),className:"flex-shrink-0 min-h-[44px] min-w-[44px] p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors focus:ring-2 focus:ring-red-500","aria-label":s?`移除 ${l} - ${a}`:`Remove ${l} at ${a}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})},z=({date:n,screenings:d,onRemoveScreening:o})=>{const{i18n:m}=j(),s=m.language==="zh",h=t=>{const r=new Date(t),l=u(r,"EEEE");if(s){const i=u(r,"M"),a=u(r,"d");return`${i}月${a}日 (${{Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六",Sunday:"星期日"}[l]||l})`}else return u(r,"MMMM d (EEEE)")};return e.jsxs("div",{"data-testid":"date-group",className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("h3",{"data-testid":"date-header",className:"text-lg font-semibold text-foreground mb-4",children:h(n)}),e.jsx("div",{className:"space-y-3",children:d.map(t=>e.jsx(E,{selection:t,conflicts:t.conflicts,onRemove:o},t.screening_id))})]})},D=({selections:n,onRemoveScreening:d,onExport:o})=>{const{i18n:m}=j(),s=m.language==="tc",h=k.useMemo(()=>{if(n.length===0)return[];const t=[...n].sort((i,a)=>new Date(i.screening_snapshot.datetime).getTime()-new Date(a.screening_snapshot.datetime).getTime()),r=new Map;t.forEach(i=>{const a=u(new Date(i.screening_snapshot.datetime),"yyyy-MM-dd");r.has(a)||r.set(a,[]),r.get(a).push(i)});const l=[];return r.forEach((i,a)=>{const x=i.map((c,w)=>{const f=[],b=new Date(c.screening_snapshot.datetime),_=new Date(b.getTime()+c.screening_snapshot.duration_minutes*6e4);for(let v=0;v<i.length;v++){if(v===w)continue;const g=i[v],y=new Date(g.screening_snapshot.datetime),N=new Date(y.getTime()+g.screening_snapshot.duration_minutes*6e4),M=Math.max(0,Math.min(_.getTime(),N.getTime())-Math.max(b.getTime(),y.getTime()));if(M>0){const p=Math.round(M/6e4);f.push({severity:"impossible",screening_ids:[c.screening_id,g.screening_id],overlap_minutes:p,message_tc:`與另一場次重疊 ${p} 分鐘`,message_en:`Overlaps ${p} minutes with another screening`})}else{const p=Math.abs(b.getTime()-N.getTime())/6e4;!(c.venue_snapshot.id===g.venue_snapshot.id)&&p<30&&f.push({severity:"warning",screening_ids:[c.screening_id,g.screening_id],overlap_minutes:0,message_tc:"與另一場次間隔少於30分鐘，且在不同場地",message_en:"Less than 30 minutes between screenings at different venues"})}}return{...c,conflicts:f.length>0?f:void 0}});l.push({date:a,screenings:x})}),l},[n]);return n.length===0?e.jsx("div",{"data-testid":"schedule-view",className:"bg-card rounded-xl shadow-lg p-12",children:e.jsxs("div",{"data-testid":"schedule-empty-state",className:"text-center max-w-md mx-auto space-y-6",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:s?"開始規劃您的電影之旅":"Start Planning Your Film Journey"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:s?"瀏覽影片目錄，選擇您喜愛的場次，建立專屬的觀影時間表":"Browse the catalogue, select your favorite screenings, and build your personalized schedule"}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{onClick:()=>window.history.back(),className:`px-8 py-3 bg-gradient-to-r from-primary to-secondary 
                         text-white font-semibold rounded-xl shadow-lg
                         hover:shadow-xl hover:scale-105
                         transition-all duration-200
                         focus:ring-2 focus:ring-primary focus:ring-offset-2`,children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})}),s?"探索電影":"Explore Films"]})})]})}):e.jsxs("div",{"data-testid":"schedule-view",className:"bg-card rounded-xl shadow-md",children:[e.jsxs("div",{className:"p-6 border-b border-border flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:s?"我的觀影時間表":"My Schedule"}),e.jsxs("button",{"data-testid":"export-btn",onClick:o,"aria-label":s?"匯出我的觀影時間表為 Markdown":"Export my schedule as Markdown",className:"group relative min-h-[48px] px-7 py-3 bg-gradient-to-br from-secondary via-secondary to-accent text-white rounded-xl font-bold shadow-lg hover:shadow-2xl hover:scale-105 focus:ring-4 focus:ring-secondary/50 focus:ring-offset-2 transition-all duration-300 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s?"匯出 Markdown":"Export Markdown"]})]})]}),e.jsx("div",{className:"p-6 space-y-6",children:h.map(t=>e.jsx(z,{date:t.date,screenings:t.screenings,onRemoveScreening:d},t.date))})]})};export{D as ScheduleView};
