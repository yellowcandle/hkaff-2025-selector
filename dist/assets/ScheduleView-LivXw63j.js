import{u as b,j as e,r as k}from"./index-Dwweknxv.js";import{f as u}from"./format-sbWH3_uq.js";const T=({conflict:n})=>{const{i18n:o}=b(),d=o.language==="zh",m=d?n.message_tc:n.message_en,s=n.severity==="impossible";return e.jsxs("div",{"data-testid":"conflict-warning",className:`flex items-start gap-2 p-3 rounded-md ${s?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsx("svg",{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${s?"text-red-500":"text-yellow-600"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:`text-sm font-medium ${s?"text-red-800":"text-yellow-800"}`,children:[s?d?"衝突":"Conflict":d?"警告":"Warning",": ",m]}),s&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:d?"此場次與另一場次時間重疊，無法同時觀看":"This screening overlaps with another and cannot be attended simultaneously"})]})]})},E=({selection:n,conflicts:o,onRemove:d})=>{const{i18n:m}=b(),s=m.language==="zh",{film_snapshot:h,screening_snapshot:t,venue_snapshot:i}=n,l=s?h.title_tc:h.title_en,r=s?i.name_tc:i.name_en,a=u(new Date(t.datetime),"HH:mm"),x=o&&o.length>0;return e.jsx("div",{"data-testid":"schedule-item",className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[x&&e.jsx("div",{"data-testid":"conflict-icon",className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{"data-testid":"schedule-time",className:"text-lg font-bold text-gray-900",children:a}),e.jsx("span",{"data-testid":"schedule-film-title",className:"text-gray-900 font-medium",children:l})]}),e.jsx("div",{"data-testid":"schedule-venue",className:"text-gray-600 text-sm mb-1",children:r}),e.jsxs("div",{className:"text-gray-500 text-xs",children:[t.duration_minutes," ",s?"分鐘":"minutes"]}),x&&e.jsx("div",{className:"mt-3",children:o.map((c,j)=>e.jsx(T,{conflict:c},j))})]})]})}),e.jsx("button",{"data-testid":"remove-screening-btn",onClick:()=>d(n.screening_id),className:"flex-shrink-0 min-h-[44px] min-w-[44px] p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors focus:ring-2 focus:ring-red-500","aria-label":s?`移除 ${l} - ${a}`:`Remove ${l} at ${a}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})},$=({date:n,screenings:o,onRemoveScreening:d})=>{const{i18n:m}=b(),s=m.language==="zh",h=t=>{const i=new Date(t),l=u(i,"EEEE");if(s){const r=u(i,"M"),a=u(i,"d");return`${r}月${a}日 (${{Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六",Sunday:"星期日"}[l]||l})`}else return u(i,"MMMM d (EEEE)")};return e.jsxs("div",{"data-testid":"date-group",className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("h3",{"data-testid":"date-header",className:"text-lg font-semibold text-gray-900 mb-4",children:h(n)}),e.jsx("div",{className:"space-y-3",children:o.map(t=>e.jsx(E,{selection:t,conflicts:t.conflicts,onRemove:d},t.screening_id))})]})},S=({selections:n,onRemoveScreening:o,onExport:d})=>{const{i18n:m}=b(),s=m.language==="zh",h=k.useMemo(()=>{if(n.length===0)return[];const t=[...n].sort((r,a)=>new Date(r.screening_snapshot.datetime).getTime()-new Date(a.screening_snapshot.datetime).getTime()),i=new Map;t.forEach(r=>{const a=u(new Date(r.screening_snapshot.datetime),"yyyy-MM-dd");i.has(a)||i.set(a,[]),i.get(a).push(r)});const l=[];return i.forEach((r,a)=>{const x=r.map((c,j)=>{const v=[],y=new Date(c.screening_snapshot.datetime),M=new Date(y.getTime()+c.screening_snapshot.duration_minutes*6e4);for(let f=0;f<r.length;f++){if(f===j)continue;const g=r[f],w=new Date(g.screening_snapshot.datetime),N=new Date(w.getTime()+g.screening_snapshot.duration_minutes*6e4),_=Math.max(0,Math.min(M.getTime(),N.getTime())-Math.max(y.getTime(),w.getTime()));if(_>0){const p=Math.round(_/6e4);v.push({severity:"impossible",screening_ids:[c.screening_id,g.screening_id],overlap_minutes:p,message_tc:`與另一場次重疊 ${p} 分鐘`,message_en:`Overlaps ${p} minutes with another screening`})}else{const p=Math.abs(y.getTime()-N.getTime())/6e4;!(c.venue_snapshot.id===g.venue_snapshot.id)&&p<30&&v.push({severity:"warning",screening_ids:[c.screening_id,g.screening_id],overlap_minutes:0,message_tc:"與另一場次間隔少於30分鐘，且在不同場地",message_en:"Less than 30 minutes between screenings at different venues"})}}return{...c,conflicts:v.length>0?v:void 0}});l.push({date:a,screenings:x})}),l},[n]);return n.length===0?e.jsx("div",{"data-testid":"schedule-view",className:"bg-white rounded-lg shadow-md p-8",children:e.jsxs("div",{"data-testid":"schedule-empty-state",className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s?"沒有已選場次":"No screenings selected"}),e.jsx("p",{className:"text-gray-500",children:s?"選擇電影場次來建立您的觀影時間表":"Select film screenings to build your schedule"})]})}):e.jsxs("div",{"data-testid":"schedule-view",className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s?"我的觀影時間表":"My Schedule"}),e.jsx("button",{"data-testid":"export-btn",onClick:d,"aria-label":s?"匯出我的觀影時間表為 Markdown":"Export my schedule as Markdown",className:"min-h-[44px] px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:s?"匯出 Markdown":"Export Markdown"})]}),e.jsx("div",{className:"p-6 space-y-6",children:h.map(t=>e.jsx($,{date:t.date,screenings:t.screenings,onRemoveScreening:o},t.date))})]})};export{S as ScheduleView};
