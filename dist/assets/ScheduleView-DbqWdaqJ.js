import{u as w,j as e,r as z}from"./index-CfTJxCR2.js";import{f as p}from"./format-Cdttx4Da.js";const C=({conflict:t})=>{const{i18n:o}=w(),i=o.language==="zh",u=i?t.message_tc:t.message_en,s=t.severity==="impossible";return e.jsxs("div",{"data-testid":"conflict-warning",className:`flex items-start gap-2 p-3 rounded-md ${s?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:[e.jsx("svg",{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${s?"text-red-500":"text-yellow-600"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:`text-sm font-medium ${s?"text-red-800":"text-yellow-800"}`,children:[s?i?"衝突":"Conflict":i?"警告":"Warning",": ",u]}),s&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i?"此場次與另一場次時間重疊，無法同時觀看":"This screening overlaps with another and cannot be attended simultaneously"})]})]})},D=({selection:t,conflicts:o,onRemove:i})=>{const{i18n:u}=w(),s=u.language==="zh",{film_snapshot:l,screening_snapshot:d,venue_snapshot:c}=t,m=s?l.title_tc:l.title_en,r=s?c.name_tc:c.name_en,a=p(new Date(d.datetime),"HH:mm"),x=o&&o.length>0;return e.jsx("div",{"data-testid":"schedule-item",className:"bg-card rounded-lg p-4 border border-border shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[x&&e.jsx("div",{"data-testid":"conflict-icon",className:"flex-shrink-0 mt-1",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{"data-testid":"schedule-time",className:"text-lg font-bold text-foreground",children:a}),e.jsx("span",{"data-testid":"schedule-film-title",className:"text-foreground font-medium",children:m})]}),e.jsx("div",{"data-testid":"schedule-venue",className:"text-muted-foreground text-sm mb-1",children:r}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[d.duration_minutes," ",s?"分鐘":"minutes"]}),x&&e.jsx("div",{className:"mt-3",children:o.map((n,h)=>e.jsx(C,{conflict:n},h))})]})]})}),e.jsx("button",{"data-testid":"remove-screening-btn",onClick:()=>i(t.screening_id),className:"flex-shrink-0 min-h-[44px] min-w-[44px] p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors focus:ring-2 focus:ring-red-500","aria-label":s?`移除 ${m} - ${a}`:`Remove ${m} at ${a}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})},$=({date:t,screenings:o,onRemoveScreening:i})=>{const{i18n:u}=w(),s=u.language==="zh",l=d=>{const c=new Date(d),m=p(c,"EEEE");if(s){const r=p(c,"M"),a=p(c,"d");return`${r}月${a}日 (${{Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六",Sunday:"星期日"}[m]||m})`}else return p(c,"MMMM d (EEEE)")};return e.jsxs("div",{"data-testid":"date-group",className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("h3",{"data-testid":"date-header",className:"text-lg font-semibold text-foreground mb-4",children:l(t)}),e.jsx("div",{className:"space-y-3",children:o.map(d=>e.jsx(D,{selection:d,conflicts:d.conflicts,onRemove:i},d.screening_id))})]})},W=({selections:t,onRemoveScreening:o,onExport:i})=>{const{i18n:u}=w(),s=u.language==="tc",l=z.useMemo(()=>{if(t.length===0)return[];const r=[...t].sort((n,h)=>new Date(n.screening_snapshot.datetime).getTime()-new Date(h.screening_snapshot.datetime).getTime()),a=new Map;r.forEach(n=>{const h=p(new Date(n.screening_snapshot.datetime),"yyyy-MM-dd");a.has(h)||a.set(h,[]),a.get(h).push(n)});const x=[];return a.forEach((n,h)=>{const k=n.map((g,T)=>{const j=[],y=new Date(g.screening_snapshot.datetime),E=new Date(y.getTime()+g.screening_snapshot.duration_minutes*6e4);for(let b=0;b<n.length;b++){if(b===T)continue;const f=n[b],N=new Date(f.screening_snapshot.datetime),_=new Date(N.getTime()+f.screening_snapshot.duration_minutes*6e4),M=Math.max(0,Math.min(E.getTime(),_.getTime())-Math.max(y.getTime(),N.getTime()));if(M>0){const v=Math.round(M/6e4);j.push({severity:"impossible",screening_ids:[g.screening_id,f.screening_id],overlap_minutes:v,message_tc:`與另一場次重疊 ${v} 分鐘`,message_en:`Overlaps ${v} minutes with another screening`})}else{const v=Math.abs(y.getTime()-_.getTime())/6e4;!(g.venue_snapshot.id===f.venue_snapshot.id)&&v<30&&j.push({severity:"warning",screening_ids:[g.screening_id,f.screening_id],overlap_minutes:0,message_tc:"與另一場次間隔少於30分鐘，且在不同場地",message_en:"Less than 30 minutes between screenings at different venues"})}}return{...g,conflicts:j.length>0?j:void 0}});x.push({date:h,screenings:k})}),x},[t]);if(t.length===0)return e.jsx("div",{"data-testid":"schedule-view",className:"bg-gradient-to-br from-card via-card to-muted/20 rounded-2xl shadow-lg p-12",children:e.jsxs("div",{"data-testid":"schedule-empty-state",className:"text-center max-w-md mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-primary/20 via-secondary/20 to-accent/20 flex items-center justify-center shadow-lg",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary/30 to-secondary/30 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent",children:s?"開始規劃您的電影之旅":"Start Planning Your Film Journey"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed text-lg",children:s?"瀏覽影片目錄，選擇您喜愛的場次，建立專屬的觀影時間表":"Browse the catalogue, select your favorite screenings, and build your personalized schedule"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-muted-foreground",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent to-muted-foreground"}),e.jsx("span",{children:s?"或":"or"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-l from-transparent to-muted-foreground"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsx("div",{className:"font-semibold text-primary mb-1",children:s?"🎬 探索":"🎬 Explore"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?"瀏覽豐富的電影選擇":"Browse film selection"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-secondary/5 border border-secondary/10",children:[e.jsx("div",{className:"font-semibold text-secondary mb-1",children:s?"⏰ 安排":"⏰ Schedule"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?"規劃您的觀影時間":"Plan your screenings"})]})]}),e.jsxs("button",{onClick:()=>window.history.back(),className:"w-full px-8 py-4 bg-gradient-to-r from-primary via-secondary to-accent text-white font-bold rounded-2xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3 group",children:[e.jsx("svg",{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16l-4-4m0 0l4-4m-4 4h18"})}),s?"返回瀏覽電影":"Browse Films"]})]})});const d=l.length,c=t.length,m=t.filter(r=>!!l.find(x=>x.screenings.find(n=>n.screening_id===r.screening_id&&n.conflicts))).length;return e.jsxs("div",{"data-testid":"schedule-view",className:"bg-card rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 p-8 border-b border-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent mb-3",children:s?"我的觀影時間表":"My Schedule"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsxs("span",{className:"text-muted-foreground",children:[c," ",s?"場次":"screenings"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-secondary"}),e.jsxs("span",{className:"text-muted-foreground",children:[d," ",s?"天":"days"]})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-destructive animate-pulse"}),e.jsxs("span",{className:"text-muted-foreground",children:[m," ",s?"個衝突":"conflicts"]})]})]})]}),e.jsxs("button",{"data-testid":"export-btn",onClick:i,"aria-label":s?"匯出我的觀影時間表為 Markdown":"Export my schedule as Markdown",className:"group relative min-h-[52px] px-8 py-3 bg-gradient-to-br from-secondary via-secondary to-accent text-white rounded-xl font-bold shadow-lg hover:shadow-2xl hover:scale-105 focus:ring-4 focus:ring-secondary/50 focus:ring-offset-2 transition-all duration-300 overflow-hidden flex items-center gap-2 whitespace-nowrap",children:[e.jsx("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),e.jsx("svg",{className:"w-5 h-5 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"relative z-10",children:s?"匯出 Markdown":"Export"})]})]})}),e.jsx("div",{className:"p-8 space-y-8",children:l.map((r,a)=>e.jsxs("div",{children:[e.jsx($,{date:r.date,screenings:r.screenings,onRemoveScreening:o}),a<l.length-1&&e.jsx("div",{className:"mt-8 h-px bg-gradient-to-r from-transparent via-border to-transparent"})]},r.date))})]})};export{W as ScheduleView};
